<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArUco &amp; AprilTag Pattern Generator</title>
  <link rel="icon" href="https://mess.engineering/favicon/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="https://mess.engineering/favicon/apple-touch-icon.png">
  <style>
    :root {
      --bg: #0f0f12;
      --surface: #1a1a20;
      --border: #2a2a32;
      --accent: #00d4aa;
      --text: #e8e8ec;
      --muted: #888;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "JetBrains Mono", "Fira Code", "Consolas", monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 1rem;
    }
    h1 { font-size: clamp(1.1rem, 3vw, 1.4rem); color: var(--accent); margin: 0 0 0.5rem 0; }
    .sub { font-size: 0.85rem; color: var(--muted); margin-bottom: 0.35rem; }
    .nav-links { font-size: 0.9rem; margin-bottom: 1rem; }
    .nav-links a { color: var(--accent); text-decoration: none; }
    .nav-links a:hover { text-decoration: underline; }
    .nav-sep { color: var(--muted); margin: 0 0.4rem; }
    section { margin-bottom: 1.5rem; }
    section h2 { font-size: 0.95rem; color: var(--muted); margin: 0 0 0.5rem 0; }
    .grid-wrap {
      display: inline-block;
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 4px;
      background: var(--surface);
    }
    .grid-row { display: flex; }
    .grid-cell {
      width: 22px; height: 22px;
      margin: 1px;
      border-radius: 4px;
      background: var(--border);
      cursor: pointer;
      transition: background 0.15s;
    }
    .grid-cell.filled { background: var(--accent); }
    .grid-cell:hover { filter: brightness(1.2); }
    .grid-cell .cell-id { font-size: 9px; line-height: 1; opacity: 0.9; display: block; margin-top: 1px; }
    .grid-cell.filled .cell-id { color: var(--bg); }
    .grid-cell:not(.filled) .cell-id { color: var(--muted); }
    .controls { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; margin-bottom: 1rem; }
    button {
      font-family: inherit;
      font-size: 0.9rem;
      padding: 0.5rem 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
    }
    button:hover { background: #25252c; border-color: var(--accent); }
    button.primary { background: var(--accent); color: var(--bg); border-color: var(--accent); }
    button.primary:hover { filter: brightness(1.1); }
    label { font-size: 0.85rem; color: var(--muted); }
    input[type="number"] { width: 4rem; margin-left: 0.25rem; padding: 0.35rem; background: var(--surface); border: 1px solid var(--border); border-radius: 6px; color: var(--text); }
    #outCanvas { display: block; max-width: 100%; height: auto; border: 1px solid var(--border); border-radius: 8px; background: #fff; }
    .preview-wrap { margin-top: 1rem; }
    .footer-by { margin-top: 2rem; font-size: 0.8rem; color: var(--muted); }
    .grid-cell.filled { background: var(--accent); }
    .marker-type-note { font-size: 0.85rem; color: var(--muted); margin-top: 0.5rem; }
    .marker-type-note a { color: var(--accent); }
    .apriltag-info { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-top: 0.5rem; font-size: 0.9rem; color: var(--text); }
    .apriltag-info a { color: var(--accent); }
  </style>
</head>
<body>
  <h1>ArUco &amp; AprilTag Pattern Generator</h1>
  <p class="sub">Build a layout, generate PNG. ArUco 4×4 (DICT_4X4_1000) or AprilTag 36h11 (see note).</p>
  <nav class="nav-links">
    <a href="scanner.html">← Scanner</a>
    <span class="nav-sep">·</span>
    <a href="generator.html">Pattern generator</a>
  </nav>

  <section>
    <h2>Marker type</h2>
    <div class="controls">
      <label>Type: <select id="markerType"><option value="aruco" selected>ArUco 4×4</option><option value="apriltag">AprilTag 36h11</option></select></label>
      <span id="fakePatternWrap">
        <label title="Fill empty cells: ArUco = ID 251+, AprilTag = fake markers">
          <input type="checkbox" id="fillGrid" checked> Fill grid
        </label>
      </span>
    </div>
    <div id="apriltagInfo" class="apriltag-info" style="display: none;">
      AprilTag 36h11 (587 IDs). Filled = real tags (ID 0–586). Empty = fill with fake markers or leave blank (Fill grid).
    </div>
  </section>

  <section>
    <h2>Layout: Klick = Filled / Empty</h2>
    <p class="marker-type-note" id="layoutNote">ArUco: Filled = ID 1–250. Empty = Fill grid (251+) or blank. Use scanner 4×4 (1000) + Byte swap (OpenCV).</p>
    <div class="controls">
      <label>Grid: <input type="number" id="gridRows" value="11" min="3" max="25" title="Rows"> × <input type="number" id="gridCols" value="11" min="3" max="25" title="Columns"></label>
      <button type="button" id="btnSmiley" class="primary">Smiley preset</button>
      <button type="button" id="btnLogo">LOGO</button>
      <button type="button" id="btnClear">Clear</button>
    </div>
    <div class="grid-wrap" id="gridWrap"></div>
  </section>

  <section>
    <h2>Options</h2>
    <div class="controls">
      <label>Marker size (px): <input type="number" id="markerPx" value="60" min="20" max="200"></label>
      <label>Quiet zone between markers (px): <input type="number" id="paddingPx" value="14" min="2" max="60"></label>
    </div>
  </section>

  <section id="generateSection">
    <h2>Preview &amp; Download</h2>
    <div class="controls">
      <a id="btnDownload" href="#" download="aruco_pattern.png" style="display: none;">Download PNG</a>
    </div>
    <div class="preview-wrap">
      <canvas id="outCanvas"></canvas>
    </div>
  </section>

  <p class="footer-by"><a href="https://mess.engineering" target="_blank" rel="noopener">M.E.S.S.</a></p>

  <script>
    (function () {
      // DICT_4X4 (OpenCV). 50/250 = prefix of 1000. ArUco: Filled = first half, Empty = second half (unique per rotation).
      function byteSwap16(code) { return ((code & 0xff) << 8) | (code >>> 8); }
      var CODE_LIST_4X4_1000 = [0x32b5,0x9a0f,0x2d33,0x4699,0x9e54,0xcd79,0x2e9e,0xf2c4,0xdafe,0x56cf,0x91f9,0xa711,0xb70e,0xf2a,0xb124,0x3e26,0x6546,0x66,0x5e6c,0xaf76,0x8b86,0x2bb0,0xd5cc,0x82dd,0x47fe,0x7194,0xe4ac,0x54a5,0x2321,0x6f34,0x1544,0xb257,0xcf9e,0xcbf0,0xae08,0x2909,0x7518,0xff04,0xf60d,0x5a1c,0x1817,0x282a,0x8c32,0xb238,0xe824,0xeb2e,0x3f2d,0x644b,0x2e50,0x1350,0x9451,0x6855,0x415d,0x975f,0x168,0x6768,0x2461,0xe961,0x126b,0xe56f,0xdf67,0x1b7e,0xa080,0x4483,0xa28b,0x7a93,0x6c84,0x2a85,0x9c85,0x899c,0xa19f,0x7cbb,0x4bc,0x5bb6,0xc8bf,0xabb7,0x1fca,0x62c9,0x58d9,0xd5d3,0x98cc,0xa0c7,0x37c5,0x5de9,0x25f9,0xbbfb,0x2aee,0x4df7,0x7535,0xad8a,0x1776,0xcf0a,0x4b06,0xc12d,0xd849,0xf443,0x364f,0xd34f,0xe469,0xc770,0x6e7a,0xeab4,0x4fed,0xe7fc,0xa6fe,0x2500,0x4300,0x880a,0x860a,0x6f02,0x1c00,0x9700,0x3708,0x310a,0xc609,0x10b,0xfb09,0x580b,0x8210,0x2d18,0x7810,0x7310,0x7412,0xb112,0xf91a,0x613,0xe0c,0xf10c,0x3304,0x9f0c,0xf20e,0xfd0e,0x4c07,0xa40f,0x2f07,0xb505,0x910f,0xdb07,0xe41e,0x3914,0x801d,0xc815,0x8b1f,0xba15,0xb11d,0x8020,0xe928,0xa222,0x5328,0xf02a,0xf722,0x4029,0x4621,0xb929,0x9c2b,0xb22b,0xca38,0x2e38,0x730,0xe738,0x493a,0x653a,0x5d32,0x883b,0x1d39,0xd33b,0x4726,0x8027,0xaa2f,0x142d,0xde25,0x5325,0x772f,0x4834,0xa83c,0x413c,0xd34,0xfb34,0x9a36,0xe03d,0x6a35,0x93d,0xed3d,0xc43f,0x6c3f,0xce37,0x5c3d,0x763d,0xb037,0x173f,0xff3f,0xe548,0x6842,0x2d4a,0x6041,0x5149,0xdd41,0xdf4b,0x4f58,0x485a,0x1658,0x5d50,0xfa5a,0xb55a,0x2351,0x8a5b,0x1959,0x3551,0x694c,0xc146,0xb4e,0x5f44,0x594e,0x834d,0x7d4d,0xd847,0x7347,0x855c,0x445e,0x2b56,0xbb5c,0xc355,0x6e5f,0xeb5f,0x125d,0x5e55,0x7062,0x1562,0xc261,0x206b,0x4563,0x5c6b,0x5b6b,0xc78,0xcf7a,0x7f78,0x8079,0xe571,0x7471,0xb679,0xd371,0x337b,0x6a64,0xa866,0xa76e,0x916e,0x2265,0xcb6d,0x8d67,0x316d,0x807e,0xe27e,0x8d7e,0xd274,0x327c,0x357e,0xab75,0x577,0x2b7f,0xda7d,0x927f,0x7580,0xf380,0xa681,0xed89,0xfc81,0xa698,0x209a,0x4391,0xf999,0x9391,0xd49b,0x984,0x6b84,0xc486,0x648e,0x1a86,0x4e85,0xcb8d,0x6785,0xaf85,0xd785,0xb387,0xe19c,0xf29c,0x1794,0x95,0xa295,0x239d,0x629f,0x529d,0xda95,0xc5a0,0xcdaa,0xd8a2,0x57a2,0x3da9,0x57a9,0x52ab,0x36a3,0x59a3,0xf4b0,0x12b8,0xbfb0,0x9db2,0xedbb,0x72b9,0x96b9,0xc3a4,0xd2ac,0xb1ae,0x82a5,0x65af,0x7ba5,0xfaaf,0x64b4,0x62bc,0x81b4,0xa0b6,0xeebe,0xdbe,0xd9bc,0xf8be,0x28b5,0x9b7,0xd2b7,0xeac0,0x19c0,0xfdc0,0xd3c8,0x5aca,0x4dc1,0xb4c9,0x57c1,0x98c3,0x1dc3,0x80d8,0xefd8,0x2bda,0x1ed0,0x5d1,0xadd3,0xa7db,0xc9c4,0x78cc,0x45cd,0xbc5,0xcfcf,0xacdc,0x2d4,0x63dc,0x27d4,0xf5d4,0x78d6,0xb8de,0xe6dd,0x5dd5,0xbddd,0x1ddf,0xcae2,0x6bea,0xb4e0,0x38e2,0xd4e2,0x22e3,0xd8e1,0x3f0,0xccf2,0xf6f8,0x49f1,0xeaf3,0x9cf1,0xf5f9,0x3bf1,0x8dec,0xc9ee,0xfe6,0xf7e4,0x60e7,0xe8ef,0xb2ed,0x15e5,0xd1ef,0x86f4,0x1fc,0xc3f6,0x7cf4,0x93fc,0x42f5,0x98fd,0x3df5,0xbd02,0xe100,0xe202,0xae02,0x7808,0x7400,0x9e08,0xd108,0x7d08,0x320a,0xde0a,0x5102,0xa201,0x8003,0x830b,0x4b0b,0x270b,0xef0b,0xb609,0x5909,0x9309,0xf80b,0xd903,0xf103,0xc410,0xab18,0xa01a,0x41a,0x6c1a,0xae1a,0x8912,0x1710,0xf31a,0x4019,0x211,0x2b11,0xcf11,0x221b,0x2e13,0x1511,0xbb13,0x200c,0xc90c,0xdc0c,0x360c,0x1406,0x7206,0x610d,0xd05,0x8f0d,0xe00f,0x490f,0x8507,0x9005,0x330d,0x960f,0x760f,0x6014,0x8d1c,0xda14,0x731c,0x941e,0xba1e,0xd916,0x3d1e,0xfb16,0xe91d,0xfe1d,0x9f1f,0x8b28,0xaf20,0xe22,0xa922,0x8d2a,0xa32a,0xef2a,0x9028,0x3b28,0x582a,0x3322,0xa021,0x221,0xa521,0xc721,0x32b,0x6723,0x3029,0xd229,0x192b,0x9b2b,0x972b,0x2838,0xa538,0x863a,0x132,0x9f38,0xd232,0x993a,0xd53a,0xe839,0xc13b,0x4333,0xe73b,0x9a31,0x9033,0x9e3b,0xc424,0x4a2c,0xad2c,0xcf2c,0x672c,0xea26,0xe52e,0x702c,0x122e,0xd12e,0x392e,0x6425,0xe725,0xcc2f,0xbc2d,0x712d,0xd525,0x9b25,0x1027,0x7c2f,0xf227,0x3a27,0xb62f,0xd327,0xb32f,0x1f27,0x4b3c,0xc036,0xee36,0xe93e,0xb834,0x143c,0x523c,0x7234,0x7e34,0xbf34,0x713e,0x533e,0x8c3d,0xa235,0x2e35,0x2d35,0xac37,0x7035,0xfa37,0xf13f,0xdb3f,0xc448,0xe948,0xc24a,0x414a,0xeb42,0x1348,0xd84a,0xfd42,0x174a,0x6349,0x6e43,0x3a41,0xb149,0x3d41,0x924b,0x9b4b,0x3f43,0x2258,0xaa50,0x2758,0xc852,0x8452,0xa52,0xf5a,0x9858,0x5c58,0xdb50,0xf750,0xf45a,0xec51,0x4251,0xd51,0x35b,0xeb53,0x7651,0x7159,0x9351,0xf953,0xb35b,0x9753,0x4c4c,0x4b44,0x234c,0x8c46,0x274e,0x9046,0xd44e,0xce45,0xe545,0x2745,0xc14f,0x547,0x3445,0x7245,0xc85c,0xe5c,0xeb54,0x8956,0x4356,0xe75e,0x705c,0xb254,0x795e,0xf356,0xa35d,0xf25d,0x1d55,0x9d5d,0xfc57,0xd257,0x735f,0x2d68,0xc368,0x8768,0x4a6a,0x6962,0xb960,0xff68,0xdc6a,0xda6a,0x3e6a,0x516a,0x316a,0xd762,0xcc61,0x826b,0xe36b,0x3a69,0x9e61,0x9561,0x7561,0x5f69,0x3769,0xda63,0x270,0x6378,0x4f70,0xca72,0xad7a,0x7b70,0x147a,0xf97a,0xd37a,0xbb7a,0xe279,0x2971,0x677b,0xd071,0x3979,0x3073,0xb973,0x5373,0xff73,0x886c,0x964,0x436c,0x666,0x8366,0xb064,0xda64,0x9f6e,0xc867,0xee6f,0x3b6d,0xd26f,0x8074,0xab7c,0x687e,0x27e,0x9c7c,0x3674,0x117c,0xde7e,0xb67e,0xdb76,0xc47d,0x8a7d,0x6d75,0x8877,0x2077,0x4177,0x3875,0xbe75,0x9b7d,0x5777,0x2888,0xac80,0xd88,0x6788,0x4e82,0xa18a,0x2b82,0x1880,0xf988,0x9d80,0x9c8a,0x3182,0x758a,0x9782,0x981,0xeb81,0x781,0x288b,0xac8b,0x2e83,0xe583,0x5081,0x3289,0x7a8b,0x968b,0x7d83,0x8790,0xfc9a,0xf592,0xaa91,0x4193,0x2593,0xeb9b,0x3499,0xf791,0xda9b,0x5693,0x4284,0x818c,0x4f8c,0x4886,0xa686,0x38e,0xe386,0x6f86,0xaf8e,0x5e84,0x7784,0xfa86,0x1e8e,0x378e,0xa87,0x8a8f,0x268f,0x2187,0xd87,0x7285,0x3e87,0x439c,0x619e,0x5894,0xf894,0x329c,0x7694,0xb194,0xdd94,0x9b94,0xdb9c,0x9c9e,0xd29e,0x1996,0xb19e,0x6995,0x6d9f,0x2b97,0xb695,0xb995,0x3d9d,0x579d,0xeca8,0x25a8,0xaca2,0x2a2,0x66aa,0x8faa,0xe7aa,0x30a8,0x7aa8,0xf6a8,0x93a8,0x14a2,0x34aa,0x72a2,0xf2aa,0xf1a2,0x40a1,0xaa9,0x26a1,0xc5a9,0xcfa9,0x34a1,0x12a9,0xfaa1,0x98ab,0xf7a3,0x6b0,0x45b0,0x8db8,0x84b2,0xf0b8,0x55b8,0x76b2,0x91ba,0x71b2,0xc0b9,0x42b9,0x2ab9,0x8cb3,0xcab3,0x66bb,0xfb3,0xdab1,0x14bb,0xf6bb,0x13b3,0x68a4,0x2cac,0xa1ac,0xebac,0xc7ac,0x67a4,0xc0a6,0xe0ae,0x23a6,0xe8ad,0xcca5,0xeca7,0x7cad,0x1aa5,0x91a5,0x19ad,0x97a5,0x6db4,0xcbbe,0x3abc,0xf5bc,0xbdbe,0xf3be,0x25b5,0x8fb5,0x68b7,0xe4bf,0xfebd,0x9dbd,0xf5b5,0xf3b5,0xb0bf,0x5ab7,0x3ebf,0x39b7,0xd5bf,0x1db7,0x35bf,0x7fb7,0x1c8,0xa5c0,0x82c2,0xbdc8,0xfcc2,0x91ca,0x5bc2,0x44c9,0x2ac1,0xc0c3,0x7ac9,0xb9c1,0x75c9,0xf7c1,0xb1cb,0x6cd0,0x87d8,0xafd0,0xc4da,0xcd2,0x9da,0x30d0,0x94d8,0x3ad0,0xb6d0,0x75d0,0x76d2,0x5dda,0x35da,0x17d2,0x2d9,0xe8d3,0xe5d3,0x9ad1,0xf6d1,0x51d1,0x14db,0x3ed3,0xd3d3,0x60c4,0xa7cc,0x42c6,0x47c6,0xe7ce,0x5cc4,0x1dcc,0x35cc,0xbcc6,0xa8cd,0xcc5,0xe4c5,0xc2c5,0x2dcd,0x59cd,0x95cd,0x93c5,0x5fc7,0xc5d4,0x88de,0x24d6,0xecde,0xe2d6,0xc6de,0x23de,0xdcdc,0x1adc,0x11d4,0x54de,0x94d6,0x9dde,0x81dd,0xa5d5,0xacd7,0x66d7,0xa9df,0xdcd5,0x1fdd,0xf0df,0x48e2,0xe8e2,0x7e2,0x5de0,0xf5ea,0x26eb,0xedeb,0x52e1,0x7ee1,0xdbe9,0x6f8,0xeef0,0xa1f8,0xfa,0xc2fa,0x9bf0,0xf4fa,0x3cfa,0xfcf2,0xbdf2,0x93f2,0x60f1,0xecf9,0x46f1,0xe1f9,0x48f3,0xaef3,0xc1f3,0x8bf3,0xa7f3,0x73f1,0x97f1,0xf4f3,0x32fb,0x7e4,0x4de6,0x55ec,0xc0ed,0x85ed,0xa2ef,0x4ee7,0xd5e5,0x50ef,0x22f4,0x89f4,0x29f4,0x6af6,0xbfe,0x6ffe,0x95f4,0x35f4,0x1ff4,0xb0f6,0xe8f5,0xc5f5,0x23fd,0xc0ff,0xccf7,0xe9f7,0xbcf5,0xf6fd,0xd9f5,0x97fd,0x3ffd,0x9cff,0x5aff,0xfef7,0x11ff,0xbff7];
      // AprilTag 36h11 (587 codes); 8x8 with 1-cell border, data at (BIT_X[i], BIT_Y[i]) 1..6
      var CODE_LIST_36H11 = [0x0d7e00984b,0x0dda664ca7,0x0dc4a1c821,0x0e17b470e9,0x0ef91d01b1,0x0f429cdd73,0x005da29225,0x01106cba43,0x0223bed79d,0x021f51213c,0x033eb19ca6,0x03f76eb0f8,0x0469a97414,0x045dcfe0b0,0x04a6465f72,0x051801db96,0x05eb946b4e,0x068a7cc2ec,0x06f0ba2652,0x078765559d,0x087b83d129,0x086cc4a5c5,0x08b64df90f,0x09c577b611,0x0a3810f2f5,0x0af4d75b83,0x0b59a03fef,0x0bb1096f85,0x0d1b92fc76,0x0d0dd509d2,0x0e2cfda160,0x02ff497c63,0x047240671b,0x05047a2e55,0x0635ca87c7,0x0691254166,0x068f43d94a,0x06ef24bdb6,0x08cdd8f886,0x09de96b718,0x0aff6e5a8a,0x0bae46f029,0x0d225b6d59,0x0df8ba8c01,0x0e3744a22f,0x0fbb59375d,0x018a916828,0x022f29c1ba,0x0286887d58,0x041392322e,0x075d18ecd1,0x087c302743,0x08c6317ba9,0x09e40f36d7,0x0c0e5a806a,0x0cc78cb87c,0x012d2f2d01,0x0379f36a21,0x06973f59ac,0x07789ea9f4,0x08f1c73e84,0x08dd287a20,0x094a4eee4c,0x0a455379b5,0x0a9e92987d,0x0bd25cb40b,0x0be98d3582,0x0d3d5972b2,0x014c53d7c7,0x04f1796936,0x04e71fed1a,0x066d46fae0,0x0a55abb933,0x0ebee1acca,0x01ad4ba6a4,0x0305b17571,0x0553611351,0x059ca62775,0x07819cb6a1,0x0edb7bc9eb,0x05b2694212,0x072e12d185,0x0ed6152e2c,0x05bcdadbf3,0x078e0aa0c6,0x0c60a0b909,0x0ef9a34b0d,0x0398a6621a,0x0a8a27c944,0x04b564304e,0x052902b4e2,0x0857280b56,0x0a91b2c84b,0x0e91df939b,0x01fa405f28,0x023793ab86,0x068c17729f,0x09fbf3b840,0x036922413c,0x04eb5f946e,0x0533fe2404,0x063de7d35e,0x0925eddc72,0x099b8b3896,0x0aace4c708,0x0c22994af0,0x08f1eae41b,0x0d95fb486c,0x013fb77857,0x04fe0983a3,0x0d559bf8a9,0x0e1855d78d,0x0fec8daaad,0x071ecb6d95,0x0dc9e50e4c,0x0ca3a4c259,0x0740d12bbf,0x0aeedd18e0,0x0b509b9c8e,0x05232fea1c,0x019282d18b,0x076c22d67b,0x0936beb34b,0x008a5ea8dd,0x0679eadc28,0x0a08e119c5,0x020a6e3e24,0x07eab9c239,0x096632c32e,0x0470d06e44,0x08a70212fb,0x00a7e4251b,0x09ec762cc0,0x0d8a3a1f48,0x0db680f346,0x04a1e93a9d,0x0638ddc04f,0x04c2fcc993,0x001ef28c95,0x0bf0d9792d,0x06d27557c3,0x0623f977f4,0x035b43be57,0x0bb0c428d5,0x0a6f01474d,0x05a70c9749,0x020ddabc3b,0x02eabd78cf,0x090aa18f88,0x0a9ea89350,0x03cdb39b22,0x0839a08f34,0x0169bb814e,0x01a575ab08,0x0a04d3d5a2,0x0bf7902f2b,0x0095a5e65c,0x092e8fce94,0x067ef48d12,0x06400dbcac,0x0b12d8fb9f,0x00347f45d3,0x0b35826f56,0x0c546ac6e4,0x081cc35b66,0x041d14bd57,0x00c052b168,0x07d6ce5018,0x0ab4ed5ede,0x05af817119,0x0d1454b182,0x02badb090b,0x003fcb4c0c,0x02f1c28fd8,0x093608c6f7,0x04c93ba2b5,0x007d950a5d,0x0e54b3d3fc,0x015560cf9d,0x0189e4958a,0x062140e9d2,0x0723bc1cdb,0x02063f26fa,0x0fa08ab19f,0x07955641db,0x0646b01daa,0x071cd427cc,0x009a42f7d4,0x0717edc643,0x015eb94367,0x08392e6bb2,0x0832408542,0x02b9b874be,0x0b21f4730d,0x0b5d8f24c9,0x07dbaf6931,0x01b4e33629,0x013452e710,0x0e974af612,0x01df61d29a,0x099f2532ad,0x0e50ec71b4,0x05df0a36e8,0x04934e4cea,0x0e34a0b4bd,0x0b7b26b588,0x00f255118d,0x0d0c8fa31e,0x006a50c94f,0x0f28aa9f06,0x0131d194d8,0x0622e3da79,0x0ac7478303,0x0c8f2521d7,0x06c9c881f5,0x049e38b60a,0x0513d8df65,0x0d7c2b0785,0x09f6f9d75a,0x09f6966020,0x01e1a54e33,0x0c04d63419,0x0946e04cd7,0x01bdac5902,0x056469b830,0x0ffad59569,0x086970e7d8,0x08a4b41e12,0x0ad4688e3b,0x085f8f5df4,0x0d833a0893,0x02a36fdd7c,0x0d6a857cf2,0x08829bc35c,0x05e50d79bc,0x0fbb8035e4,0x0c1a95bebf,0x0036b0baf8,0x0e0da964ea,0x0b6483689b,0x07c8e2f4c1,0x05b856a23b,0x02fc183995,0x0e914b6d70,0x0b31041969,0x01bb478493,0x0063e2b456,0x0f2a082b9c,0x08e5e646ea,0x008172f8f6,0x00dacd923e,0x0e5dcf0e2e,0x0bf9446bae,0x04822d50d1,0x026e710bf5,0x0b90ba2a24,0x0f3b25aa73,0x0809ad589b,0x094cc1e254,0x05334a3adb,0x0592886b2f,0x0bf64704aa,0x0566dbf24c,0x072203e692,0x064e61e809,0x0d7259aad6,0x07b924aedc,0x02df2184e8,0x0353d1eca7,0x0fce30d7ce,0x0f7b0f436e,0x057e8d8f68,0x08c79e60db,0x09c8362b2b,0x063a5804f2,0x09298353dc,0x06f98a71c8,0x0a5731f693,0x021ca5c870,0x01c2107fd3,0x06181f6c39,0x019e574304,0x0329937606,0x0043d5c70d,0x09b18ff162,0x08e2ccfebf,0x072b7b9b54,0x09b71f4f3c,0x0935d7393e,0x065938881a,0x06a5bd6f2d,0x0a19783306,0x0e6472f4d7,0x081163df5a,0x0a838e1cbd,0x0982748477,0x0050c54feb,0x00d82fbb58,0x02c4c72799,0x097d259ad6,0x022d9a43ed,0x0fdb162a9f,0x00cb4a727d,0x04fae2e371,0x0535b5be8b,0x048795908a,0x0ce7c18962,0x04ea154d80,0x050c064889,0x08d97fc75d,0x0c8bd9ec61,0x083ee8e8bb,0x0c8431419a,0x01aa78079d,0x08111aa4a5,0x0dfa3a69fe,0x051630d83f,0x02d930fb3f,0x02133116e5,0x0ae5395522,0x0bc07a4e8a,0x057bf08ba0,0x06cb18036a,0x0f0e2e4b75,0x03eb692b6f,0x0d8178a3fa,0x0238cce6a6,0x0e97d5cdd7,0x0fe10d8d5e,0x0b39584a1d,0x0ca03536fd,0x0aa61f3998,0x072ff23ec2,0x015aa7d770,0x057a3a1282,0x0d1f3902dc,0x06554c9388,0x0fd01283c7,0x0e8baa42c5,0x072cee6adf,0x0f6614b3fa,0x095c3778a2,0x07da4cea7a,0x0d18a5912c,0x0d116426e5,0x027c17bc1c,0x0b95b53bc1,0x0c8f937a05,0x0ed220c9bd,0x00c97d72ab,0x08fb1217ae,0x025ca8a5a1,0x0b261b871b,0x01bef0a056,0x0806a51179,0x0eed249145,0x03f82aeceb,0x0cc56e9acf,0x02e78d01eb,0x0102cee17f,0x037caad3d5,0x016ac5b1ee,0x02af164ece,0x0d4cd81dc9,0x012263a7e7,0x057ac7d117,0x09391d9740,0x07aedaa77f,0x09675a3c72,0x0277f25191,0x0ebb6e64b9,0x07ad3ef747,0x012759b181,0x0948257d4d,0x0b63a850f6,0x03a52a8f75,0x04a019532c,0x0a021a7529,0x0cc661876d,0x04085afd05,0x0e7048e089,0x03f979cdc6,0x0d9da9071b,0x0ed2fc5b68,0x079d64c3a1,0x0fd44e2361,0x08eea46a74,0x042233b9c2,0x0ae4d1765d,0x07303a094c,0x02d7033abe,0x03dcc2b0b4,0x00f0967d09,0x006f0cd7de,0x009807aca0,0x03a295cad3,0x02b106b202,0x03f38a828e,0x078af46596,0x0bda2dc713,0x09a8c8c9d9,0x06a0f2ddce,0x0a76af6fe2,0x0086f66fa4,0x0d52d63f8d,0x089f7a6e73,0x0cc6b23362,0x0b4ebf3c39,0x0564f300fa,0x0e8de3a706,0x079a033b61,0x0765e160c5,0x0a266a4f85,0x0a68c38c24,0x0dca0711fb,0x085fba85ba,0x037a207b46,0x0158fcc4d0,0x00569d79b3,0x07b1a25555,0x0a8ae22468,0x07c592bdfd,0x00c59a5f66,0x0b1115daa3,0x0f17c87177,0x06769d766b,0x02b637356d,0x013d8685ac,0x0f24cb6ec0,0x00bd0b56d1,0x042ff0e26d,0x0b41609267,0x096f9518af,0x0c56f96636,0x04a8e10349,0x0863512171,0x0ea455d86c,0x0bd0e25279,0x0e65e3f761,0x036c84a922,0x085fd1b38f,0x0657c91539,0x015033fe04,0x009051c921,0x0ab27d80d8,0x0f92f7d0a1,0x08eb6bb737,0x010b5b0f63,0x06c9c7ad63,0x0f66fe70ae,0x0ca579bd92,0x0956198e4d,0x029e4405e5,0x0e44eb885c,0x041612456c,0x0ea45e0abf,0x0d326529bd,0x07b2c33cef,0x080bc9b558,0x07169b9740,0x0c37f99209,0x031ff6dab9,0x0c795190ed,0x0a7636e95f,0x09df075841,0x055a083932,0x0a7cbdf630,0x0409ea4ef0,0x092a1991b6,0x04b078dee9,0x0ae18ce9e4,0x05a6e1ef35,0x01a403bd59,0x031ea70a83,0x02bc3c4f3a,0x05c921b3cb,0x0042da05c5,0x01f667d16b,0x0416a368cf,0x0fbc0a7a3b,0x09419f0c7c,0x081be2fa03,0x034e2c172f,0x028648d8ae,0x0c7acbb885,0x045f31eb6a,0x0d1cfc0a7b,0x042c4d260d,0x0cf6584097,0x094b132b14,0x03c5c5df75,0x08ae596fef,0x0aea8054eb,0x00ae9cc573,0x0496fb731b,0x0ebf105662,0x0af9c83a37,0x0c0d64cd6b,0x07b608159a,0x0e74431642,0x0d6fb9d900,0x0291e99de0,0x010500ba9a,0x05cd05d037,0x0a87254fb2,0x09d7824a37,0x08b2c7b47c,0x030c788145,0x02f4e5a8be,0x0badb884da,0x0026e0d5c9,0x06fdbaa32e,0x034758eb31,0x0565cd1b4f,0x02bfd90fb0,0x0093052a6b,0x0d3c13c4b9,0x02daea43bf,0x0a279762bc,0x0f1bd9f22c,0x04b7fec94f,0x0545761d5a,0x07327df411,0x01b52a442e,0x049b0ce108,0x024c764bc8,0x0374563045,0x0a3e8f91c6,0x00e6bd2241,0x0e0e52ee3c,0x007e8e3caa,0x096c2b7372,0x033acbdfda,0x0b15d91e54,0x0464759ac1,0x06886a1998,0x057f5d3958,0x05a1f5c1f5,0x00b58158ad,0x0e712053fb,0x05352ddb25,0x0414b98ea0,0x074f89f546,0x038a56b3c3,0x038db0dc17,0x0aa016a755,0x0dc72366f5,0x00cee93d75,0x0b2fe7a56b,0x0a847ed390,0x08713ef88c,0x0a217cc861,0x08bca25d7b,0x0455526818,0x0ea3a7a180,0x0a9536e5e0,0x09b64a1975,0x05bfc756bc,0x0046aa169b,0x053a17f76f,0x04d6815274,0x0cca9cf3f6,0x04013fcb8b,0x03d26cdfa5,0x05786231f7,0x07d4ab09ab,0x0960b5ffbc,0x08914df0d4,0x02fc6f2213,0x0ac235637e,0x0151b28ed3,0x046f79b6db,0x01382e0c9f,0x053abf983a,0x0383c47ade,0x03fcf88978,0x0eb9079df7,0x009af0714d,0x0da19d1bb7,0x09a02749f8,0x01c62dab9b,0x01a137e44b,0x02867718c7,0x035815525b,0x07cd35c550,0x02164f73a0,0x0e8b772fe0];
      var APRILTAG_BIT_X = [1,2,3,4,5,2,3,4,3,6,6,6,6,6,5,5,5,4,6,5,4,3,2,5,4,3,4,1,1,1,1,1,2,2,2,3];
      var APRILTAG_BIT_Y = [1,1,1,1,1,2,2,2,3,1,2,3,4,5,2,3,4,3,6,6,6,6,6,5,5,5,4,6,5,4,3,2,5,4,3,4];

      var ROWS = 11, COLS = 11;

      function resizeGrid(newRows, newCols) {
        newRows = Math.max(3, Math.min(25, parseInt(newRows, 10) || 11));
        newCols = Math.max(3, Math.min(25, parseInt(newCols, 10) || 11));
        var newGrid = [];
        for (var r = 0; r < newRows; r++) {
          newGrid[r] = [];
          for (var c = 0; c < newCols; c++) {
            newGrid[r][c] = (r < grid.length && c < (grid[r] && grid[r].length)) ? grid[r][c] : 0;
          }
        }
        grid = newGrid;
        ROWS = newRows;
        COLS = newCols;
        var ri = document.getElementById('gridRows'), ci = document.getElementById('gridCols');
        if (ri) ri.value = ROWS;
        if (ci) ci.value = COLS;
        renderGrid();
        generate();
      }

      var SMILEY = [
        [0,0,0,0,0,0,0,0,0,0,0],
        [0,1,1,1,0,0,0,1,1,1,0],
        [0,1,0,1,0,0,0,1,0,1,0],
        [0,1,1,1,0,0,0,1,1,1,0],
        [0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0],
        [1,0,0,0,0,0,0,0,0,0,1],
        [0,1,0,0,0,0,0,0,0,1,0],
        [0,0,1,0,0,0,0,0,1,0,0],
        [0,0,0,1,1,1,1,1,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0]
      ];

      // MESS logo: 15×15, center cross (row 7, col 7), 7×7 per quadrant = 1 Rand + 5×5 Buchstabe + 1 Rand
      var M_5 = [[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1]];
      var E_5 = [[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,1,1,1,1]];
      var S_5 = [[0,1,1,1,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[1,1,1,1,0]];
      var MESS_LOGO = (function () {
        var g = [];
        for (var r = 0; r < 15; r++) {
          g[r] = [];
          for (var c = 0; c < 15; c++) {
            if (r === 7 || c === 7) { g[r][c] = 1; continue; }
            if (r <= 6 && c <= 6) g[r][c] = (r >= 1 && r <= 5 && c >= 1 && c <= 5) ? M_5[r - 1][c - 1] : 0;
            else if (r <= 6 && c >= 8) g[r][c] = (r >= 1 && r <= 5 && c >= 9 && c <= 13) ? E_5[r - 1][c - 9] : 0;
            else if (r >= 8 && c <= 6) g[r][c] = (r >= 9 && r <= 13 && c >= 1 && c <= 5) ? S_5[r - 9][c - 1] : 0;
            else if (r >= 8 && c >= 8) g[r][c] = (r >= 9 && r <= 13 && c >= 9 && c <= 13) ? S_5[r - 9][c - 9] : 0;
            else g[r][c] = 0;
          }
        }
        return g;
      })();

      // ArUco 4x4: 6x6 cells, 1 black border, 4x4 data. Byte-swapped code, MSB top-left, inner matrix inverted (1=white, 0=black) — matches js-aruco2 + scanner "Byte swap (OpenCV)".
      function drawMarker(ctx, code, x, y, cellPx) {
        var size = 6 * cellPx;
        ctx.fillStyle = '#000';
        ctx.fillRect(x, y, size, size);
        ctx.fillStyle = '#000';
        ctx.fillRect(x + cellPx, y + cellPx, 4 * cellPx, 4 * cellPx);
        ctx.fillStyle = '#fff';
        for (var r = 0; r < 4; r++) {
          for (var c = 0; c < 4; c++) {
            var bitIdx = 15 - (r * 4 + c);
            var bit = (code >>> bitIdx) & 1;
            if (bit) ctx.fillRect(x + (c + 1) * cellPx, y + (r + 1) * cellPx, cellPx, cellPx);
          }
        }
      }
      // Build set of 16-bit codes that decode as valid ArUco (code and byte-swapped). Fake markers must not use these.
      var ARUCO_FORBIDDEN = {};
      for (var fi = 0; fi < CODE_LIST_4X4_1000.length; fi++) {
        var c = CODE_LIST_4X4_1000[fi];
        ARUCO_FORBIDDEN[c] = true;
        ARUCO_FORBIDDEN[byteSwap16(c)] = true;
      }
      function getFakeArUcoCode(seed) {
        var code = ((seed >>> 0) * 1103515245 + 12345) >>> 0;
        code = (code ^ (code >>> 16)) & 0xFFFF;
        var guard = 0;
        while (ARUCO_FORBIDDEN[code] && guard++ < 65536) code = (code + 1) & 0xFFFF;
        return code;
      }
      // Fake ArUco: 6×6 with border, inner 4×4 from a code that is not in the dictionary (never decodes as valid).
      function drawFakeArUco(ctx, x, y, cellPx, seed) {
        var code = getFakeArUcoCode(seed);
        drawMarker(ctx, code, x, y, cellPx);
      }

      // AprilTag 36h11: 8x8, 1-cell border (same as apriltag36h11_gen.py / apriltag36_test.html).
      // Code is 36-bit; JS bitwise ops (>>> &) use only 32 bits — use getBit36.
      var APRILTAG_SIZE_CELLS = 8;
      function getBit36(code, bitIndex) {
        return (Math.floor(code / Math.pow(2, 35 - bitIndex)) & 1);
      }
      function drawAprilTag36h11(ctx, code, x, y, cellPx) {
        var size = APRILTAG_SIZE_CELLS * cellPx;
        ctx.fillStyle = '#000';
        ctx.fillRect(x, y, size, size);
        ctx.fillStyle = '#fff';
        for (var i = 0; i < 36; i++) {
          if (getBit36(code, i) === 0) continue;
          var bx = APRILTAG_BIT_X[i], by = APRILTAG_BIT_Y[i];
          ctx.fillRect(x + bx * cellPx, y + by * cellPx, cellPx, cellPx);
        }
      }
      // Fake AprilTag: 8×8 with border, inner 36 bits scrambled (deterministic per seed). Each cell gets a different pattern.
      function drawFakeAprilTag(ctx, x, y, cellPx, seed) {
        var size = APRILTAG_SIZE_CELLS * cellPx;
        ctx.fillStyle = '#000';
        ctx.fillRect(x, y, size, size);
        ctx.fillStyle = '#fff';
        var u32 = 0x6D2B79F5; // mulberry32 step
        var t = ((seed >>> 0) * 1103515245 + 12345) >>> 0; // mix seed strongly
        for (var i = 0; i < 36; i++) {
          t = (t + u32) >>> 0;
          if ((t >>> 29) & 1) {
            var bx = APRILTAG_BIT_X[i], by = APRILTAG_BIT_Y[i];
            ctx.fillRect(x + bx * cellPx, y + by * cellPx, cellPx, cellPx);
          }
        }
      }

      var grid = [];
      for (var r = 0; r < ROWS; r++) {
        grid[r] = [];
        for (var c = 0; c < COLS; c++) grid[r][c] = 0;
      }

      // ArUco: fixed numbering. Filled = 1–250, Empty = 251+ (dict-independent; always use DICT_4X4_1000 for drawing).
      var ARUCO_FILLED_MAX = 250;
      var ARUCO_EMPTY_START = 251;
      var ARUCO_EMPTY_COUNT = 750;
      function getIdMap() {
        var idxLow = 0, idxHigh = 0;
        var isApril = document.getElementById('markerType').value === 'apriltag';
        var out = [];
        if (isApril) {
          var fillGrid = document.getElementById('fillGrid') && document.getElementById('fillGrid').checked;
          for (var r = 0; r < ROWS; r++) {
            out[r] = [];
            for (var c = 0; c < COLS; c++) {
              out[r][c] = grid[r][c] ? (idxLow++ % 587) : (fillGrid ? '✕' : '—');
            }
          }
        } else {
          var fillGrid = document.getElementById('fillGrid') && document.getElementById('fillGrid').checked;
          for (var r = 0; r < ROWS; r++) {
            out[r] = [];
            for (var c = 0; c < COLS; c++) {
              if (grid[r][c]) out[r][c] = 1 + (idxLow++ % ARUCO_FILLED_MAX);
              else out[r][c] = fillGrid ? (ARUCO_EMPTY_START + (idxHigh++ % ARUCO_EMPTY_COUNT)) : '—';
            }
          }
        }
        return out;
      }

      function renderGrid() {
        var idMap = getIdMap();
        var wrap = document.getElementById('gridWrap');
        wrap.innerHTML = '';
        for (var r = 0; r < ROWS; r++) {
          var rowEl = document.createElement('div');
          rowEl.className = 'grid-row';
          for (var c = 0; c < COLS; c++) {
            var cell = document.createElement('div');
            cell.className = 'grid-cell' + (grid[r][c] ? ' filled' : '');
            cell.dataset.r = r;
            cell.dataset.c = c;
            var idSpan = document.createElement('span');
            idSpan.className = 'cell-id';
            idSpan.textContent = idMap[r][c];
            cell.appendChild(idSpan);
            cell.addEventListener('click', function () {
              var r = parseInt(this.dataset.r, 10), c = parseInt(this.dataset.c, 10);
              grid[r][c] = grid[r][c] ? 0 : 1;
              renderGrid();
              generate();
            });
            rowEl.appendChild(cell);
          }
          wrap.appendChild(rowEl);
        }
      }

      function applyPreset(matrix) {
        for (var r = 0; r < ROWS && r < matrix.length; r++)
          for (var c = 0; c < COLS && c < matrix[r].length; c++)
            grid[r][c] = matrix[r][c];
        renderGrid();
      }

      document.getElementById('btnSmiley').addEventListener('click', function () {
        resizeGrid(11, 11);
        applyPreset(SMILEY);
        generate();
      });
      document.getElementById('btnLogo').addEventListener('click', function () {
        resizeGrid(15, 15);
        applyPreset(MESS_LOGO);
        generate();
      });
      document.getElementById('btnClear').addEventListener('click', function () {
        for (var r = 0; r < ROWS; r++) for (var c = 0; c < COLS; c++) grid[r][c] = 0;
        renderGrid();
        generate();
      });
      var gridRowsEl = document.getElementById('gridRows'), gridColsEl = document.getElementById('gridCols');
      if (gridRowsEl) gridRowsEl.addEventListener('change', function () { resizeGrid(this.value, gridColsEl ? gridColsEl.value : COLS); });
      if (gridColsEl) gridColsEl.addEventListener('change', function () { resizeGrid(gridRowsEl ? gridRowsEl.value : ROWS, this.value); });

      var markerTypeEl = document.getElementById('markerType');
      var apriltagInfoEl = document.getElementById('apriltagInfo');
      var generateSectionEl = document.getElementById('generateSection');
      function updateMarkerTypeUI() {
        var isApril = markerTypeEl && markerTypeEl.value === 'apriltag';
        if (apriltagInfoEl) apriltagInfoEl.style.display = isApril ? 'block' : 'none';
        if (generateSectionEl) generateSectionEl.style.display = 'block';
        var note = document.getElementById('layoutNote');
        if (note) note.textContent = isApril ? "AprilTag: Filled = ID 0–586. Empty = Fill grid (fake) or blank." : "ArUco: Filled = ID 1–250. Empty = Fill grid (251+) or blank. Use scanner 4×4 (1000) + Byte swap (OpenCV).";
        renderGrid();
        generate();
      }
      if (markerTypeEl) markerTypeEl.addEventListener('change', updateMarkerTypeUI);
      var fillGridEl = document.getElementById('fillGrid');
      if (fillGridEl) fillGridEl.addEventListener('change', function () { renderGrid(); generate(); });

      function generate() {
        var isApril = document.getElementById('markerType').value === 'apriltag';
        var markerPx = Math.max(20, Math.min(200, parseInt(document.getElementById('markerPx').value, 10) || 60));
        var padding = Math.max(2, Math.min(60, parseInt(document.getElementById('paddingPx').value, 10) || 14));
        var cellsPerTag = isApril ? 8 : 6;
        var cellPx = Math.floor(markerPx / cellsPerTag);
        var totalCell = cellsPerTag * cellPx;
        var w = COLS * totalCell + (COLS + 1) * padding;
        var h = ROWS * totalCell + (ROWS + 1) * padding;

        var canvas = document.getElementById('outCanvas');
        canvas.width = w;
        canvas.height = h;
        var ctx = canvas.getContext('2d');
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, w, h);

        var idxLow = 0, idxHigh = 0;
        var codesArUco = CODE_LIST_4X4_1000;
        for (var r = 0; r < ROWS; r++) {
          for (var c = 0; c < COLS; c++) {
            var px = c * totalCell + (c + 1) * padding;
            var py = r * totalCell + (r + 1) * padding;
            if (isApril) {
              if (grid[r][c]) {
                var id = idxLow++ % 587;
                drawAprilTag36h11(ctx, CODE_LIST_36H11[id], px, py, cellPx);
              } else if (document.getElementById('fillGrid') && document.getElementById('fillGrid').checked) {
                drawFakeAprilTag(ctx, px, py, cellPx, r * COLS + c);
              }
              // else empty = leave white
            } else {
              if (grid[r][c]) {
                var id = 1 + (idxLow++ % ARUCO_FILLED_MAX);
                drawMarker(ctx, byteSwap16(codesArUco[id - 1]), px, py, cellPx);
              } else {
                var fillGrid = document.getElementById('fillGrid') && document.getElementById('fillGrid').checked;
                if (fillGrid) {
                  var idEmpty = ARUCO_EMPTY_START + (idxHigh++ % ARUCO_EMPTY_COUNT);
                  drawMarker(ctx, byteSwap16(codesArUco[idEmpty - 1]), px, py, cellPx);
                }
                // else empty = leave white
              }
            }
          }
        }

        var link = document.getElementById('btnDownload');
        link.href = canvas.toDataURL('image/png');
        link.download = isApril ? 'apriltag_pattern.png' : 'aruco_pattern.png';
        link.style.display = 'inline-block';
        link.style.color = 'var(--accent)';
        link.style.marginLeft = '0.5rem';
      }

      document.getElementById('markerPx').addEventListener('input', generate);
      document.getElementById('paddingPx').addEventListener('input', generate);

      applyPreset(SMILEY);
      renderGrid();
      updateMarkerTypeUI();
      generate();
    })();
  </script>
</body>
</html>
